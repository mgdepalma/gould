/**
 * Copyright (C) Generations Linux <bugs@softcraft.org>
 * All Rights Reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */

#include "icons/apply.xpm"
#include "icons/audio.xpm"
#include "icons/back.xpm"
#include "icons/blank.xpm"
#include "icons/broken.xpm"
#include "icons/bulb.xpm"
#include "icons/camera.xpm"
#include "icons/cancel.xpm"
#include "icons/chooser.xpm"
#include "icons/close.xpm"
#include "icons/cut.xpm"
#include "icons/delete.xpm"
#include "icons/dirs.xpm"
#include "icons/done.xpm"
#include "icons/down.xpm"
#include "icons/eclipse.xpm"
#include "icons/error.xpm"
#include "icons/exec.xpm"
#include "icons/exit.xpm"
#include "icons/expand.xpm"
#include "icons/file.xpm"
#include "icons/folder.xpm"
#include "icons/forward.xpm"
#include "icons/genesis.xpm"
#include "icons/hardisk.xpm"
#include "icons/help.xpm"
#include "icons/hidden.xpm"
#include "icons/home.xpm"
#include "icons/icons.xpm"
#include "icons/image.xpm"
#include "icons/info.xpm"
#include "icons/item.xpm"
#include "icons/java.xpm"
#include "icons/lock.xpm"
#include "icons/logo.xpm"
#include "icons/logout.xpm"
#include "icons/maximize.xpm"
#include "icons/minimize.xpm"
#include "icons/menu.xpm"
#include "icons/open.xpm"
#include "icons/package.xpm"
#include "icons/paint.xpm"
#include "icons/paper.xpm"
#include "icons/paste.xpm"
#include "icons/pdf.xpm"
#include "icons/postscript.xpm"
#include "icons/print.xpm"
#include "icons/printer.xpm"
#include "icons/question.xpm"
#include "icons/rdesktop.xpm"
#include "icons/reboot.xpm"
#include "icons/record.xpm"
#include "icons/remote.xpm"
#include "icons/resize.xpm"
#include "icons/restore.xpm"
#include "icons/save.xpm"
#include "icons/setting.xpm"
#include "icons/smile.xpm"
#include "icons/snapshot.xpm"
#include "icons/start.xpm"
#include "icons/suspend.xpm"
#include "icons/symlink.xpm"
#include "icons/thumbnail.xpm"
#include "icons/title.xpm"
#include "icons/uparrow.xpm"
#include "icons/usbdrive.xpm"
#include "icons/video.xpm"
#include "icons/visible.xpm"
#include "icons/vspacer.xpm"
#include "icons/warning.xpm"
#include "icons/welcome.xpm"
#include "icons/wallpaper.xpm"
#include "icons/workspace.xpm"

#include "xpmglyphs.h"

static IconCatalog xpmglyph[] = {
  { ICON_APPLY,		apply_xpm,	NULL },
  { ICON_AUDIO,		audio_xpm,	NULL },
  { ICON_BACK,		back_xpm,	NULL },
  { ICON_BLANK,		blank_xpm,	NULL },
  { ICON_BROKEN,	broken_xpm,	NULL },
  { ICON_BULB,		bulb_xpm,	NULL },
  { ICON_CAMERA,	camera_xpm,	NULL },
  { ICON_CANCEL,	cancel_xpm,	NULL },
  { ICON_CANCEL_PRINT,	cancel_xpm,	NULL },
  { ICON_CANCEL_SAVE,	cancel_xpm,	NULL },
  { ICON_CHOOSER,	chooser_xpm,	NULL },
  { ICON_CLOSE,		close_xpm,	NULL },
  { ICON_CUT,		cut_xpm,	NULL },
  { ICON_DELETE,	delete_xpm,	NULL },
  { ICON_DIRS,		dirs_xpm,	NULL },
  { ICON_DONE,		done_xpm,	NULL },
  { ICON_DOWN,		down_xpm,	NULL },
  { ICON_ECLIPSE,	eclipse_xpm,	NULL },
  { ICON_ERROR,		error_xpm,	NULL },
  { ICON_EXEC,		exec_xpm,	NULL },
  { ICON_EXIT,		exit_xpm,	NULL },
  { ICON_EXPAND,	expand_xpm,	NULL },
  { ICON_FILE,		file_xpm,	NULL },
  { ICON_FOLDER,	folder_xpm,	NULL },
  { ICON_FORWARD,	forward_xpm,	NULL },
  { ICON_GENESIS,	genesis_xpm,	NULL },
  { ICON_HALT,		exit_xpm,	NULL },
  { ICON_HARDISK,	hardisk_xpm,	NULL },
  { ICON_HELP,		help_xpm,	NULL },
  { ICON_HIDDEN,	hidden_xpm,	NULL },
  { ICON_HOME,		home_xpm,	NULL },
  { ICON_ICONS,		icons_xpm,	NULL },
  { ICON_IMAGE,		image_xpm,	NULL },
  { ICON_INFO,		info_xpm,	NULL },
  { ICON_ITEM,		item_xpm,	NULL },
  { ICON_JAVA,		java_xpm,	NULL },
  { ICON_LOCK,		lock_xpm,	NULL },
  { ICON_LOGO,		logo_xpm,	NULL },
  { ICON_LOGOUT,	logout_xpm,	NULL },
  { ICON_MAXIMIZE,	maximize_xpm,	NULL },
  { ICON_MINIMIZE,	minimize_xpm,	NULL },
  { ICON_MENU,		menu_xpm,	NULL },
  { ICON_OPEN,		open_xpm,	NULL },
  { ICON_PACKAGE,	package_xpm,	NULL },
  { ICON_PAINT,		paint_xpm,	NULL },
  { ICON_PAPER,		paper_xpm,	NULL },
  { ICON_PASTE,		paste_xpm,	NULL },
  { ICON_PDF,		pdf_xpm,	NULL },
  { ICON_POSTSCRIPT,	postscript_xpm,	NULL },
  { ICON_PRINT,		print_xpm,	NULL },
  { ICON_PRINTER,	printer_xpm,	NULL },
  { ICON_QUESTION,	question_xpm,	NULL },
  { ICON_QUIT,		close_xpm,	NULL },
  { ICON_RDESKTOP,	rdesktop_xpm,	NULL },
  { ICON_REBOOT,	reboot_xpm,	NULL },
  { ICON_RECORD,	record_xpm,	NULL },
  { ICON_REMOTE,	remote_xpm,	NULL },
  { ICON_RESIZE,	resize_xpm,	NULL },
  { ICON_RESTORE,	restore_xpm,	NULL },
  { ICON_SAVE,		save_xpm,	NULL },
  { ICON_SAVE_AS,	save_xpm,	NULL },
  { ICON_SETTING,	setting_xpm,	NULL },
  { ICON_SMILE,		smile_xpm,	NULL },
  { ICON_SNAPSHOT,	snapshot_xpm,	NULL },
  { ICON_START,		start_xpm,	NULL },
  { ICON_SUSPEND,	suspend_xpm,	NULL },
  { ICON_SYMLINK,	symlink_xpm,	NULL },
  { ICON_THUMBNAIL,	thumbnail_xpm,	NULL },
  { ICON_TITLE,		title_xpm,	NULL },
  { ICON_UP,		uparrow_xpm,	NULL },
  { ICON_USBDRIVE,	usbdrive_xpm,	NULL },
  { ICON_VIDEO,		video_xpm,	NULL },
  { ICON_VISIBLE,	visible_xpm,	NULL },
  { ICON_VSPACER,	vspacer_xpm,	NULL },
  { ICON_WARNING,	warning_xpm,	NULL },
  { ICON_WELCOME,	welcome_xpm,	NULL },
  { ICON_WALLPAPER,	wallpaper_xpm,	NULL },
  { ICON_WORKSPACE,	workspace_xpm,	NULL }
};

/*
 * Create a GdkPixmap given IconIndex index
 */
GdkPixmap *
xpm_icon(IconIndex index, GdkBitmap **mask, GdkColor *backdrop)
{
  GdkPixmap *pixmap = xpmglyph[index].pixmap;

  if (pixmap == NULL) {
    GdkWindow *window = gdk_get_default_root_window();
    GtkStyle  *style  = gtk_widget_get_default_style();
    GdkColor  *color  = (backdrop) ? backdrop : &style->bg[GTK_STATE_NORMAL];

    pixmap = gdk_pixmap_create_from_xpm_d(window, mask, color,
                                          xpmglyph[index].data);
    xpmglyph[index].pixmap = pixmap;
  }
  return pixmap;
} /* </xpm_icon> */

/*
 * xpm_pixbuf produce a GdkPixbuf using given IconIndex
 */
GdkPixbuf *
xpm_pixbuf(IconIndex index, GdkColor *backdrop)
{
  GdkBitmap *mask = NULL;
  GdkPixmap *pixmap;
  gint width, height;

  pixmap = xpm_icon(index, &mask, backdrop);
  gdk_drawable_get_size(pixmap, &width, &height);

  return gdk_pixbuf_get_from_drawable(NULL, pixmap,
                                      gtk_widget_get_default_colormap(),
                                      0, 0, 0, 0, width, height);
} /* </xpm_pixbuf> */

GdkPixbuf *
xpm_pixbuf_scale(IconIndex index, gint width, gint height, GdkColor *backdrop)
{
  GdkPixbuf *render = xpm_pixbuf (index, backdrop);

  if (width > 0 || height > 0) {
    GdkPixbuf *pixbuf = gdk_pixbuf_scale_simple (render, width, height,
                                                   GDK_INTERP_BILINEAR);
    g_object_unref (render);

    return pixbuf;
  }
  return render;
} /* </xpm_pixbuf_scale> */

/*
 * Create a GtkImage given IconIndex index
 */
GtkWidget *
xpm_image (IconIndex index)
{
  GdkBitmap *mask = NULL;
  GdkPixmap *pixmap = xpm_icon(index, &mask, NULL);

  return gtk_image_new_from_pixmap(pixmap, mask);
} /* </xpm_image> */

GtkWidget *
xpm_image_scaled (IconIndex index, gint width, gint height)
{
  GdkPixbuf *render;
  GtkWidget *image;

  render = xpm_pixbuf_scale (index, width, height, NULL);
  image  = gtk_image_new_from_pixbuf (render);
  g_object_unref (render);

  return image;
} /* </xpm_image_scaled> */

/*
 * Create a button only with an image
 */
GtkWidget *
xpm_image_button (IconIndex index)
{
  return xpm_image_button_scaled (index, -1, -1);
} /* </xpm_image_button> */

GtkWidget *
xpm_image_button_scaled (IconIndex index, gint width, gint height)
{
  GtkWidget *button;
  GtkWidget *image;

  button = gtk_button_new ();
  gtk_button_set_relief (GTK_BUTTON(button), GTK_RELIEF_NONE);

  if (width > 0 || height > 0)
    image = xpm_image_scaled (index, width, height);
  else
    image = xpm_image (index);

  gtk_container_add (GTK_CONTAINER (button), image);
  gtk_widget_show (image);

  return button;
} /* </xpm_image_button_scaled> */

/*
 * Create a new hbox with an image and a label packed into it
 * and return the layout.
 */
GtkWidget *
xpm_label(IconIndex index, const gchar *text)
{
  GtkWidget *image;
  GtkWidget *label;
  GtkWidget *layout;

  /* Create layout for image and label */
  layout = gtk_hbox_new (FALSE, 0);
  gtk_container_set_border_width (GTK_CONTAINER (layout), 2);
  gtk_widget_show (layout);

  /* Now on to the image stuff */
  image = xpm_image(index);
  gtk_box_pack_start (GTK_BOX (layout), image, FALSE, FALSE, 3);
  gtk_widget_show (image);

  /* Create a label for the button */
  label = gtk_label_new (text);
  gtk_box_pack_start (GTK_BOX (layout), label, FALSE, TRUE, 3);
  gtk_label_set_use_markup (GTK_LABEL (label), TRUE);
  gtk_widget_show (label);

  return layout;
} /* </xpm_label> */

/*
 * Create a new button with an image and a label packed into it.
 */
GtkWidget *
xpm_button(IconIndex index, const gchar *text)
{
  GtkWidget *button;
  GtkWidget *layout;

  if (text != NULL) {     /* Create a new xpmlabel() with image and label */
    gchar padding[MAX_LABEL_LENGTH];
    sprintf(padding, "%6s", text);
    layout = xpm_label(index, padding);
  }
  else {
    layout = xpm_image(index);
    gtk_widget_show(layout);
  }

  /* Create and add the new button to the layout */
  button = gtk_button_new ();
  gtk_container_add (GTK_CONTAINER (button), layout);

  return button;
} /* </xpm_button> */
